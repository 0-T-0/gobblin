apply plugin: 'java'
apply plugin: 'eclipse'

dependencies {
  if (project.hasProperty('useHadoop2')) {
    compile externalDependency.hadoopCommon
    compile externalDependency.hadoopClientCore
    compile externalDependency.hadoopHdfs
    compile externalDependency.hadoopAuth
  } else {
    compile externalDependency.hadoop
  }
  compile externalDependency.commonsLang
  compile externalDependency.hiveService
  compile externalDependency.hiveJdbc
  compile externalDependency.hiveMetastore
  compile externalDependency.hiveExec
  compile externalDependency.antlrRuntime
  compile externalDependency.derby
  compile externalDependency.jdo2
  compile files('lib/jpox-core-1.2.2.jar')
  compile files('lib/jpox-rdbms-1.2.2.jar')
}


configurations {
  compile { transitive = true }
}

classification="library"


build << {
  copy {
    from configurations.runtime
    into ("../build/gobblin-compaction/jar/gobblin-compaction_lib")
  }
  copy {
    from "../conf/log4j-compaction.xml"
    into ("../build/gobblin-compaction/jar")
    rename ('log4j-compaction.xml', 'log4j.xml')
  }
}

jar {
  destinationDir file("../build/gobblin-compaction/jar")
  def manifestClasspath = configurations.runtime.collect { "gobblin-compaction_lib/" + it.getName() }.join(' ')
  manifestClasspath = ". " + manifestClasspath
  manifest {
    attributes("Manifest-Version"       : "1.0",
    "Main-Class"             : "gobblin.compaction.CompactionRunner",
    "Class-Path"             : manifestClasspath
    )
  }
}